---
---
<span class="theme">
  <input class="sr-only" id="theme-toggle" type="checkbox" checked="">
  <label id="theme-toggle-label" for="theme-toggle">
    Toggle theme
    <span class="icon"></span>
  </label>
</span>

<style>
  html {
    & .theme {
      display: inline;
      position: relative;

      & label {
        margin: 0 0 0 -1.5rem;
      }

      & #theme-toggle:checked ~ label > .icon {
        background: var(--dark);
        border-radius: 6px;
        bottom: 2px;
        height: 12px;
        right: -20px;
        position: absolute;
        transition: 200ms;
        width: 12px;
      }

      & #theme-toggle:not(:checked) ~ label > .icon {
        background: var(--haze);
        border-radius: 6px;
        bottom: 2px;
        right: -20px;
        height: 12px;
        position: absolute;
        transition: 200ms;
        width: 12px;

        &::after {
          background: var(--dark);
          border-radius: 6px;
          bottom: 3px;
          content: '';
          height: 12px;
          left: 4px;
          position: absolute;
          transition: 200ms;
          width: 12px;
        }
      }


      & #theme-toggle ~ label,
      & label {
        border-bottom: 1px dashed var(--dark);
        color: var(--dark);
        padding: 0.2rem 0.4rem;
        cursor: pointer;
      }
      & #theme-toggle:active ~ label,
      & #theme-toggle:focus ~ label,
      & #theme-toggle:hover ~ label {
        background-color: var(--dark);
        border-bottom: 1px dashed transparent;
        color: var(--haze);
        outline: none;
        transition: 200ms;
      }
    }
    
    &.dark {
      & .theme {
        & #theme-toggle ~ label,
        & label {
          border-bottom: 1px dashed var(--haze);
          color: var(--haze);
        }
        
        & #theme-toggle:active ~ label,
        & #theme-toggle:focus ~ label,
        & #theme-toggle:hover ~ label {
          background-color: var(--murk);
          border-bottom: 1px dashed transparent;
          color: var(--haze);
        }
      }
    }
  }
</style>

<script is:inline>
  const themeInput = document.querySelector('#theme-toggle');

  const theme = (() => {
    if (typeof sessionStorage !== 'undefined' && sessionStorage.getItem('theme')) {
      return sessionStorage.getItem('theme') ?? 'light';
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
      return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
    themeInput.checked = true;
  } else {
    document.documentElement.classList.add('dark');
    themeInput.checked = false;
  }
  
  window.sessionStorage.setItem('theme', theme);
  
  const toggleTheme = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');
    
    const isDark = element.classList.contains('dark');
    sessionStorage.setItem('theme', isDark ? 'dark' : 'light');
  }

  themeInput?.addEventListener('change', toggleTheme);

  themeInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      toggleTheme()
    }
  });
</script>
