---
import { getCollection } from 'astro:content';
import BaseLayout from '~/layouts/BaseLayout.astro';
import Note from '~/components/Note.astro';

export async function getStaticPaths() {
  const allNotes = await getCollection('notes');
  const uniqueTags = [...new Set(allNotes.map((note: any) => note.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredNotes = allNotes.filter((note: any) => note.data.tags.includes(tag));
    return {
      params: { tag },
      props: { notes: filteredNotes }
    };
  });
}

const { tag } = Astro.params;
const { notes } = Astro.props;
---
<BaseLayout pageTitle={tag}>
  <h1>Tags</h1>
  <p>These are all the notes tagged with '{tag.toLowerCase()}'.</p>
  <ul class="pages-list">
    {notes.map((note: any) => <Note category={note.data.category} date={note.data.date} description={note.data.description} title={note.data.title} url={`/notes/${note.slug}/`} />)}
  </ul>
</BaseLayout>
