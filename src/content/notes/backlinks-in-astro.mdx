---
category: "seed"
date: 2025-01-08
description: "A guide to automatic backlinking in Astro"
tags: ["astro", "development", "guide", "pkm"]
title: Backlinks in Astro
---

As part of my ongoing efforts to [plant a digital garden](/notes/digital-garden/), one feature I wanted to implement was backlinking.

A backlink connects notes that reference other notes. Making [Astro](https://astro.build) automatically add backlinks to each referenced note involved a lot of research and experimentation, but I finally achieved it with the following code:

```js
import fs from 'fs';
import path from 'path';

const { pathname } = Astro.url;
const allNotes = import.meta.glob('../content/notes/*.mdx', { eager: false });

let notes = await Promise.all(
  Object.entries(allNotes).map(async ([key, loader]) => {
    const url = key.replace('../content/notes/', '/notes/').replace('.mdx', '/');
    const contentModule = await loader();
    const filePath = path.resolve('./src/content/notes', key.replace('../content/notes/', ''));
    const rawContent = fs.readFileSync(filePath, 'utf-8');
    return {
      frontmatter: contentModule.frontmatter,
      url,
      rawContent,
    };
  })
);

const backlinksMap = {};
const linkRegex = /\[.*?\]\((.*?)\)/g;

notes.forEach(note => {
  const { url, rawContent, frontmatter } = note;
  const matches = [...rawContent.matchAll(linkRegex)];
  
  if (matches) {
    matches.forEach(match => {
      const linkedUrl = match[1];

      if (linkedUrl) {
        if (!backlinksMap[linkedUrl]) {
          backlinksMap[linkedUrl] = [];
        }
        backlinksMap[linkedUrl].push({
          category: frontmatter.category,
          date: frontmatter.date,
          description: frontmatter.description,
          title: frontmatter.title,
          url
        });
      }
    });
  }
});

const currentBacklinks = backlinksMap[pathname] || [];
```

I'll rewrite this note into a more comprehensive guide at a later date.
