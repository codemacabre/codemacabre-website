---
category: "seed"
date: 2025-01-08
description: "A guide to automatic backlinking in Astro"
tags: ["astro", "code", "guide", "pkm"]
title: Backlinks in Astro
update: 2025-01-09
---

As part of my ongoing effort to [plant a digital garden](/notes/digital-garden/), one feature I wanted to implement was backlinking.

A backlink connects notes that reference other notes. Making [Astro](https://astro.build) automatically add backlinks to each referenced note involved a lot of research and experimentation, but I finally achieved it with the following code:

```js
import { getCollection } from 'astro:content';
import Note from '~/components/Note.astro';

const { pathname } = Astro.url;
const allNotes = await getCollection('notes');
console.log(Object.entries(allNotes))

let notes = await Promise.all(
  Object.entries(allNotes).map(([key, note]) => {
    return {
      frontmatter: note.data,
      rawContent: note.body,
      url: `/notes/${note.slug}`
    };
  })
);

const backlinksMap = {};
const linkRegex = /\[.*?\]\((.*?)\)/g;

notes.forEach(note => {
  const { url, rawContent, frontmatter } = note;
  const matches = [...rawContent.matchAll(linkRegex)];
  
  if (matches) {
    matches.forEach(match => {
      const linkedUrl = match[1];

      if (linkedUrl) {
        if (!backlinksMap[linkedUrl]) {
          backlinksMap[linkedUrl] = [];
        }
        backlinksMap[linkedUrl].push({
          frontmatter,
          url
        });
      }
    });
  }
});

const currentBacklinks = backlinksMap[pathname] || [];
```

I'll rewrite this note into a more comprehensive guide at a later date.
