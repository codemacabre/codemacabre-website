---
category: "evergreen"
date: 2025-01-08
description: "A guide to automatic backlinking in Astro"
tags: ["astro", "code", "guide", "pkm"]
title: Backlinks in Astro
update: 2025-01-09
---

As part of my ongoing effort to [plant a digital garden](/notes/digital-garden), one feature I wanted to implement was backlinking.

A backlink displays other notes that reference the current note and is a staple of most personal knowledge systems (PKMs). However, it's not a feature that [Astro](https://astro.build) supports natively, so a bit of customisation is needed.

## 1. Get the notes collection

Assuming you are using Astro's [content collections](https://docs.astro.build/en/guides/content-collections/), you first need to get your notes collection. My collection is simply called 'notes', so we can use the following:

```js
import { getCollection } from 'astro:content';

const allNotes = await getCollection('notes');
```

## 2. Extract links from note content

Next, we need to find and extract any links in our notes. Regex is useful here, as markdown links follow a consistent format, `[text](url)`.

We'll also create an empty object to hold the links our regex finds.

```js
const linkRegex = /\[.*?\]\((.*?)\)/g;
const allLinks = {};
```

Now we need to iterate over each note, checking the body for links.

```js
allNotes.forEach((note) => {
  const links = [...note.body.matchAll(linkRegex)];
});
```

Each of these matched links comes with a few properties, but we want the URL of the link itself, which is the second property. Remember, this is zero-indexed, so we'll use `link[1]` to get it.

Within the `allNotes.forEach()` loop, iterate across each note's links and extract the link URL:

```js
if (links) {
  links.forEach((link) => {
    const linkUrl = link[1];
  }
}
```

We need to populate our `allLinks` object with each extracted link. First, we'll check the link doesn't already exist in the object, and initialise it with an array if not, then `push()` some data into the array.

Within the `links.forEach()` loop, add the following:

```js
if (linkUrl) {
  if (!allLinks[linkUrl]) {
    allLinks[linkUrl] = [];
  }
  allLinks[linkUrl].push({
    frontmatter: note.data,
    url: `/notes/${note.slug}`
  });
}
```

Here, we're extracting the frontmatter with the note's `data` object, and building a URL with the note's `slug`. Adjust this to match your note URL format.

## 3. Check for the current note

Now we have an object containing all the links in every note, we need to cross-reference them with the current note's URL. We can get this by using Astro's built-in [`Astro.url`](https://docs.astro.build/en/reference/api-reference/#url) object.

```js
const { pathname } = Astro.url;
```

We're destructuring the `pathname` from the current URL and we can use it to create a new array built by checking for matching entries in `allLinks`.

```js
const backlinks = allLinks[pathname] || [];
```

Now we have an array of backlinks for each note.

## 4. Final code

Here's the complete code.

```js
import { getCollection } from 'astro:content';

const { pathname } = Astro.url;
const allLinks = {};
const allNotes = await getCollection('notes');
const linkRegex = /\[.*?\]\((.*?)\)/g;

allNotes.forEach((note) => {
  const links = [...note.body.matchAll(linkRegex)];
  
  if (links) {
    links.forEach((link) => {
      const linkUrl = link[1];

      if (linkUrl) {
        if (!allLinks[linkUrl]) {
          allLinks[linkUrl] = [];
        }
        allLinks[linkUrl].push({
          frontmatter: note.data,
          url: `/notes/${note.slug}`
        });
      }
    });
  }
});

const backlinks = allLinks[pathname] || [];
```

 We could put this into the code fence at the top of a component, then iterate over the `backlinks` array to populate a list of backlinks for each note, which is exactly what I've done for my own notes.
